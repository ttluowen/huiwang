/**
 * 注册成功页。
 * 
 * @since 2018-01-27
 * @version 1.0
 * @author Luowen
 */


/**
 * 页面基本逻辑管理。
 * 
 * @return {void}
 */
((function pageManage() {
	const RESEND_CUTDOWM = 60;
	
	
	// 倒计时计时器。
	var nCutdownInterval = 0;


	var oVueOption = {
		el: "#pbody",
		data: {
			username: "",
			cutdown: RESEND_CUTDOWM
		},
		mounted() {
			this.cutdowmDo();
			$(".cutdown").show();
		},
		methods: {
			/**
			 * 重新发送。
			 * 
			 * @param {String} sUsername
			 * @return {void}
			 */
			resend: function(sUsername) {
				var _this = this;
				
				if (_this.cutdown > 0) {
					return;
				}


				// Loading 对象。
				const oLoading = this.$Message.loading({
                    content: 'Loading...',
                    duration: 0
                });


				axios.post(TOP_DOMAIN + "api/base/user/resendRegistCode", {
					token: TOKEN,
					username: sUsername
				}).then(function(oAjax) {
					var oAjaxData = oAjax.data;

					if (oAjaxData.c == 1) {
						_this.$Message.success("发送成功");
						_this.cutdowmDo();
						oLoading();
					} else {
						_this.$Message.error("发送失败");
					}
				});
			},

			/**
			 * 倒计时。
			 * 
			 * @return {void}
			 */
			cutdowmDo() {
				var _this = this;

				clearInterval(nCutdownInterval);
				nCutdownInterval = setInterval(function() {
					if (_this.cutdown > 1) {
						_this.cutdown--;
					} else {
						_this.cutdown = 0;
						clearInterval(nCutdownInterval);
					}
				}, 1000);
			}
		}
	};
	
	
	var vVue = new Vue(oVueOption);
	oVueOption = null;
}))();

