/**
 * 用户注册页脚本。
 * 
 * @since 2018-01-21
 * @version 1.0
 * @author Luowen
 */


/**
 * 页面基本逻辑管理。
 * 
 * @return {void}
 */
((function pageManage() {
	var oVueOption = {
		el: "#pbody",
		data: {
			username: "",
			nickname: "",
			email: "",
			password: "",
			password2: "",
			checkCode: ""
		},
		mounted: function() {
			document.querySelector("[name=username]").focus();
		},
		methods: {
			/**
			 * 注册。
			 */
			regist: function() {
				var _this = this;

				axios.post(TOP_DOMAIN + "api/base/user/regist", {
					token: TOKEN,
					username: _this.username,
					email: _this.email,
					password: _this.password,
					password2: _this.password2,
					checkCode: _this.checkCode
				}).then(function(oAjax) {
					var oAjaxData = oAjax.data;

					if (oAjaxData.c == 1) {
						location.href = util.substitute(decodeURIComponent(util.getParams()["redirectUrl"] || "index.html"), oAjaxData.r);
					} else {
						vVue.$Message.error("注册失败，" + oAjaxData.d);
					}
				});
			}
		}
	};
	
	
	var vVue = new Vue(oVueOption);
	oVueOption = null;
}))();


/**
 * 页面重置大小管理。
 * 
 * @return {void}
 */
((function resizeCallbackManage() {
	var fnResize = util.getParam("resizeCallback");

	if (fnResize) {
		$("load resize", () => {
			try {
				parent[fnResize] && parent[fnResize](
					document.body.scrollWidth,
					document.body.scrollHeight
				);
			} catch (oError) {
			}
		});
	}
}))();
